################################################################################
# JSON-Testbench Configuration File
################################################################################

# Optional Meta Data #
Company: 
Engineer: 
Project_Name: 
Target_Devices: 
Tool_Versions: 
Description: 
Dependencies: 

# Required Data #
Module_Name: xpams
Timescale: 1ns / 1ps #the default timescale of the simulation
Time_Format: {unit: "1us", precision: 3} #can be one of s, ms, us, ns, ps, fs
Flag_Count: 1

Interfaces:
  - axis

################################################################################

# DUT #
DUT:
  - {direction: input, name: ap_clk, type: clock, period: 20ns}
  - {direction: input, name: ap_rst_n}
  - {direction: output, size: 32, name: dbg_currentState}
  - {direction: slave, name: axis_rx, type: axis, clock: ap_clk, c_struct: axis_word, c_stream: uaxis_l,
  channels: [
      {name: "TDATA", type: "tdata", size: 64},
      {name: "TVALID", type: "tvalid"},
      {name: "TREADY", type: "tready"},
      {name: "TLAST", type: "tlast"}
    ]}
  - {direction: master, name: axis_tx, type: axis, clock: ap_clk, c_struct: axis_word, c_stream: uaxis_l,
  channels: [
      {name: "TDATA", type: "tdata", size: 64},
      {name: "TVALID", type: "tvalid"},
      {name: "TREADY", type: "tready"},
      {name: "TLAST", type: "tlast"}
    ]}
  - {direction: master, name: axis_kernel_out, type: axis, clock: ap_clk, c_struct: axis_wordDest, c_stream: uaxis_m,
  channels: [
      {name: "TDATA", type: "tdata", size: 64},
      {name: "TVALID", type: "tvalid"},
      {name: "TREADY", type: "tready"},
      {name: "TLAST", type: "tlast"}
    ]}
  - {direction: slave, name: axis_kernel_in, type: axis, clock: ap_clk, c_struct: axis_word, c_stream: uaxis_l,
  channels: [
      {name: "TDATA", type: "tdata", size: 64},
      {name: "TVALID", type: "tvalid"},
      {name: "TREADY", type: "tready"},
      {name: "TLAST", type: "tlast"}
    ]}

################################################################################

Initialize: &Initialize
  - wait: {key: ap_clk}
  - macro: INIT_SIGNALS
  - delay: 40ns
  - signal:
    - {name: ap_rst_n, value: 1}
    - {name: "axis_tx_TREADY", value: 1}
    - {name: "axis_kernel_out_TREADY", value: 1}

# This sends a AMheader + payload with no handler args to xpams. There's 
# an empty handler receiving it so it sends a reply message back and passes 
# the payload to the kernel
Medium_Message_A: &Medium_Message_A
  - Parallel_Section_0: *Initialize
  - Parallel_Section_1:
    - delay: 100ns
    - timestamp: INIT
    - interface: {type: axis, name: axis_rx, payload: [
      {tdata: "{AMHeader,0xAA,0x2,0x100,0x0,0x2,0}", tkeep: "KEEP_ALL"},
      {tdata: "{AMToken,0x0}", callTB: 1},
      {loop: { start: 0, end: 255, body: [
        {tdata: "0x98765432"}
      ]}},
      {tdata: "0x98765432", tlast: 1, callTB: 3}
    ]}
  - Parallel_Section_2:
    - interface: {type: axis, name: axis_kernel_out, payload: [
      {loop: { start: 0, end: 255, body: [
        {tdata: "0x98765432", tdest: 0x2}
      ]}},
      {tdata: "0x98765432", tlast: 1, tdest: 0x2}
    ]}
  - Parallel_Section_3:
    - interface: {type: axis, name: axis_tx, payload: [
      {tdata: "{AMHeader,0x2,0xAA,0,0x0,0x41,0}"},
      {tdata: "{AMToken,0x0}", tlast: 1}
    ]}
    - timestamp: Medium_Message_A
    - macro: END

# Empty handler reply message
Short_Message_A: &Short_Message_A
  - Parallel_Section_0: *Initialize
  - Parallel_Section_1:
    - delay: 100ns
    - timestamp: INIT
    - interface: {type: axis, name: axis_rx, payload: [
      {tdata: "{AMHeader,0xCC,0x02,0,0,0x41,0}"},
      {tdata: "{AMToken,0x1}", callTB: 2}
    ]}
  - Parallel_Section_2:
    - interface: {type: axis, name: axis_kernel_out, payload: [
      {tdata: "{AMToken,0x1}", tdest: 0x2}
    ]}
    - timestamp: Short_Message_A
    - macro: END

# This sends a AMheader + token with two handler args to xpams. There's 
# an empty handler receiving it so it just sends a reply message back. At 
# the moment, I'm not sure if it should accept more words from the GASCore 
Long_Message_A: &Long_Message_A
  - Parallel_Section_0: *Initialize
  - Parallel_Section_1:
    - delay: 100ns
    - timestamp: INIT
    - interface: {type: axis, name: axis_rx, payload: [
      {tdata: "{AMHeader,0xAA,0x2,0xC,0,0x5,2}", tkeep: "KEEP_ALL"},
      {tdata: "{AMLongStride,0x100,4,3,2}"},
      {tdata: "0xAABBCCDD"},
      {tdata: "0xDDCCBBAA", tlast: 1, callTB: 3}
    ]}
  - Parallel_Section_2:
    - interface: {type: axis, name: axis_tx, payload: [
      {tdata: "{AMHeader,0x2,0xAA,0,0,0x41,0}"},
      {tdata: "{AMToken,0x2}", tlast: 1}
    ]}
    - timestamp: Long_Message_A
    - macro: END
################################################################################

Wait_Conditions:
  - {condition: "@(negedge ap_clk);", key: ap_clk}

Test_Vectors:
  # - Test_Vector_0: *Medium_Message_A
  # - Test_Vector_1: *Long_Message_A
  - Test_Vector_0: *Short_Message_A
  - Test_Vector_1: *Medium_Message_A
  - Test_Vector_2: *Long_Message_A
  